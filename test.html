<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>테스트트트트</title>
    <link rel="stylesheet" href="./css/aa.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.24.0/babel.js"></script>    
    <script src="//cdn.polyfill.io/v1/polyfill.min.js" async defer></script>
</head>

<body class="site">
    <div class="box">
        <ul class="product-list">
            <li>
                <div class="img">
                    <img src="./images/shop-profile-big.jpg" alt="">
                </div>
                <div class="middle">
                    <p class="tit">타이틀 텍스트</p>
                    <p class="text">제품설명 문구제품설명 문구제품설명 문구제품설명 문구제품설명 문구 제품설명 문구제품설명 문구제품설명 문구제품설명 문구제품설명</p>
                </div>
                <div class="bottom">
                    <ul class="bottom-list">
                        <li>제품명</li>
                        <li>제품명</li>
                    </ul>
                </div>
                <div class="detail-link">
                    <a href="#">자세히 보기</a>
                </div>
            </li>
            <li>
                <div class="img">
                    <img src="./images/shop-profile-big.jpg" alt="">
                </div>
                <div class="middle">
                    <p class="tit">타이틀 텍스트</p>
                    <p class="text">제품설명 문구제품설명 문구제품설명 문구제</p>
                </div>
                <div class="bottom">
                    <ul class="bottom-list">
                        <li>제품명</li>
                        <li>제품명</li>
                        <li>제품명</li>
                    </ul>
                </div>
                <div class="detail-link">
                    <a href="#">자세히 보기</a>
                </div>
            </li>
            <li>
                <div class="img">
                    <img src="./images/shop-profile-big.jpg" alt="">
                </div>
                <div class="middle">
                    <p class="tit">타이틀 텍스트</p>
                    <p class="text">제품설명</p>
                </div>
                <div class="bottom">
                    <ul class="bottom-list">
                        <li>제품명</li>
                    </ul>
                </div>
                <div class="detail-link">
                    <a href="#">자세히 보기</a>
                </div>
            </li>
            <li>
                <div class="img">
                    <img src="./images/shop-profile-big.jpg" alt="">
                </div>
                <div class="middle">
                    <p class="tit">타이틀 텍스트</p>
                    <p class="text">제품설명 문구제품설명 문구제품설명 제품설명 문구제품설명 문구제품설명 문구제</p>
                </div>
                <div class="bottom">
                    <ul class="bottom-list">
                        <li>제품명</li>
                        <li>제품명</li>
                    </ul>
                </div>
                <div class="detail-link">
                    <a href="#">자세히 보기</a>
                </div>
            </li>
            <li>
                <div class="img">
                    <img src="./images/shop-profile-big.jpg" alt="">
                </div>
                <div class="middle">
                    <p class="tit">타이틀 텍스트</p>
                    <p class="text">제품설명 문구제품설명 문구제품설명 문구제</p>
                </div>
                <div class="bottom">
                    <ul class="bottom-list">
                        <li>제품명</li>
                        <li>제품명</li>
                        <li>제품명</li>
                    </ul>
                </div>
                <div class="detail-link">
                    <a href="#">자세히 보기</a>
                </div>
            </li>
            <li>
                <div class="img">
                    <img src="./images/shop-profile-big.jpg" alt="">
                </div>
                <div class="middle">
                    <p class="tit">타이틀 텍스트</p>
                    <p class="text">제품설명</p>
                </div>
                <div class="bottom">
                    <ul class="bottom-list">
                        <li>제품명</li>
                    </ul>
                </div>
                <div class="detail-link">
                    <a href="#">자세히 보기</a>
                </div>
            </li>
            <li>
                <div class="img">
                    <img src="./images/shop-profile-big.jpg" alt="">
                </div>
                <div class="middle">
                    <p class="tit">타이틀 텍스트</p>
                    <p class="text">제품설명 문구제품설명 문</p>
                </div>
                <div class="bottom">
                    <ul class="bottom-list">
                        <li>제품명</li>
                        <li>제품명</li>
                    </ul>
                </div>
                <div class="detail-link">
                    <a href="#">자세히 보기</a>
                </div>
            </li>
            <!-- <li>
                <div class="img">
                    <img src="./images/shop-profile-big.jpg" alt="">
                </div>
                <div class="middle">
                    <p class="tit">타이틀 텍스트</p>
                    <p class="text">제품설명 문구제품설명 문구제품설명 문구제제품설명 문구제품설명 문구제품설</p>
                </div>
                <div class="bottom">
                    <ul class="bottom-list">
                        <li>제품명</li>
                        <li>제품명</li>
                        <li>제품명</li>
                    </ul>
                </div>
                <div class="detail-link">
                    <a href="#">자세히 보기</a>
                </div>
            </li> -->
        </ul>
    </div>
    <script type="text/babel">
        // idx 구하기
        function getElementIndex(element, range) {
            if (!!range) return [].indexOf.call(element, range);
            return [].indexOf.call(element.parentNode.children, element);
        }
        
        const _list = document.querySelector('.product-list');
        const _li = _list.children;
        function responseText() {
            // viewport 구분으로 라인별 max 갯수 구하기
            let view_count = 0;
            if (window.matchMedia("(min-width: 981px)").matches) {
                view_count = 3;
            } else if (window.matchMedia("(min-width: 769px) and (max-width: 980px").matches) {
                view_count = 2;
            } else {
                view_count = 1;
            }

            // 동일 라인 엘리먼트를 구하기 위해 offset 변수 선언
            const first_top = _li[0].offsetTop;
            let p_top = first_top;

            // 일단 보기 쉽게 for문...
            for (let i = 0; i < _li.length; i += view_count) {
                const _in_li = _li[i];
                // 인덱스 선언
                const idx = getElementIndex(_li, _in_li);

                // 라인 별 엘리먼트 뽑아오기
                const _in_top = _in_li.offsetTop;
                const result = Array.prototype.filter.call(_in_li.parentNode.children, (child, j) =>
                    (j >= idx) && (j < idx + view_count)
                );
                // 라인 마다 최대 높이 값
                var heightArray = result.map(x => {
                    x.querySelector('.text').style.height = '';
                    return x.querySelector('.text').offsetHeight;
                });
                var maxHeight = Math.max.apply(Math, heightArray);
                
                // 라인별 height 변경
                for (let k = 0; k < result.length; k++) {
                    result[k].querySelector('.text').style.height = maxHeight + 'px';
                }

                // 맨 앞 엘리먼트를 찾기 위해 초기화
                p_top = _in_top;
            }

        }
        responseText();

        window.addEventListener("resize", () => responseText());
    </script>
</body>

</html>